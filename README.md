# IP Scanner v2

**IP Scanner v2** は、高速で動作する非同期Webサービスクローラーおよび簡易脆弱性診断ツールです。
指定したIPアドレスやランダムなIPアドレスに対してスキャンを実行し、発見したWebサーバーの情報（タイトル、ヘッダー、SSL証明書の有効期限など）を収集し、リアルタイムでダッシュボードに表示します。

## ⚠️ 免責事項 (Disclaimer) ⚠️
本ツールは、**教育目的**および**明示的な許可を得たシステム・ネットワークに対するセキュリティ監査目的**でのみ提供されています。
許可されていない第三者のサーバーやネットワークに対する無断スキャン行為は、不正アクセス禁止法やその他の関連法令・プロバイダ規約に抵触する恐れがあります。
本ツールの使用によって生じたいかなる損害や法的トラブルについて、作成者は一切の責任を負いません。**本ツールの利用はすべてユーザー自身の自己責任で行ってください。**
不特定多数へのスキャン（ランダムIPスキャン等）を利用する際は、倫理的・法的に問題ない範囲でのみ使用してください。

---

## ✨ 主な機能
- **高速な非同期スキャン**: `aiohttp` を活用した並行処理により、高速なネットワークスキャンを実現。
- **2つのスキャンモード**:
  1. **指定IPスキャン (Target Scan)**: 特定のIPアドレス、CIDR、またはドメイン名を指定してスキャンを実行。
  2. **ランダムIPスキャン (Random Scan)**: インターネット上のIPアドレスをランダムに生成して探索。
- **詳細なサービス情報収集**:
  - ステータスコード、ページタイトル、サーバーヘッダ情報の取得。
  - SSL/TLS証明書情報（発行者、ドメイン、有効期限）の取得。
  - 逆引きDNSによるホスト名の解決、およびIPアドレスから国籍情報を取得。
- **自動スクリーンショット機能**: `Playwright` を使用して、発見したWebページのスクリーンショットを自動的に撮影・保存。
- **簡易脆弱性スクリーニング**:
  - 重大なセキュリティヘッダ（HSTS, CSP 等）の欠落チェック。
  - 管理パネル（`/admin`, `/wp-admin`, `/phpmyadmin` 等）や機密ファイル（`/.env`, `/.git/config` 等）の露出スキャン。
  - 古いSSL証明書や自己署名証明書の検出、ディレクトリリスティング等の設定ミスチェック。
- **リアルタイム・ダッシュボード**: WebSocketを利用し、スキャン進行状況や発見されたサービスをブラウザ上のモダンなUIでリアルタイムに確認可能。

## 🛠️ 技術スタック
- **Backend**: Python 3.x, FastAPI, aiohttp, SQLite (aiosqlite)
- **Frontend**: HTML5, Vanilla CSS, Vanilla JavaScript, WebSocket
- **Automation**: Playwright (スクリーンショット取得用)

## 🚀 インストール方法

1. リポジトリをクローン（またはダウンロード）します。
   ```bash
   git clone <リポジトリのURL>
   cd ipscan
   ```

2. 必要なPythonパッケージをインストールします。
   ```bash
   pip install -r requirements.txt
   ```

3. スクリーンショット用のブラウザ依存関係（Playwright）をインストールします。
   ```bash
   playwright install chromium
   ```

## 🎮 使い方

1. アプリケーションサーバーを起動します。
   ```bash
   python app.py
   ```
   ※もしくは `uvicorn app:app --host 0.0.0.0 --port 8000`

2. ブラウザでアクセスします。
   デフォルトでは以下のURLでダッシュボードにアクセスできます。
   [http://localhost:8000](http://localhost:8000)

3. ダッシュボード上のUIから、スキャンするポートや機能（脆弱性チェック、スクリーンショットの有無など）を選択し、スキャンを開始します。

## 📂 ディレクトリ構成
- `app.py`: FastAPIのメインアプリケーションファイル。ルーティングとAPI、WebSocketを定義。
- `scanner.py`: コアとなる非同期スキャンエンジン。
- `vuln_scanner.py`: セキュリティヘッダーや、特定パスの探索など脆弱性診断のロジック。
- `database.py`: スキャン結果をSQLiteに保存・取得するための処理。
- `screenshot.py`: Playwrightを利用したスクリーンショット撮影処理。
- `ip_generator.py`: ランダムIPスキャン用のIP生成ロジック。
- `static/`: ダッシュボードUI用の静的ファイル（HTML, JS, CSS）。
- `screenshots/`: 取得したスクリーンショットが保存されるディレクトリ（自動生成）。
- `ipscan.db`: スキャン結果データを永続化するSQLiteデータベース（自動生成）。

## 📝 ログとデータ管理
スキャンされたすべての結果はローカルの `ipscan.db` (SQLiteデータベース) に保存されます。結果はダッシュボード上から検索、フィルタリング、削除することが可能です。
